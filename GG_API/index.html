<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Demo - Standalone</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <header>
        <h1>ğŸ—ºï¸ Google Maps Demo - Test Version</h1>
    </header>

    <!-- Cáº£nh bÃ¡o API Key -->
    <div id="apiWarning" class="api-warning">
        âš ï¸ <strong>Cáº£nh bÃ¡o:</strong> Äang sá»­ dá»¥ng API Key máº«u. Vui lÃ²ng thay báº±ng API Key cá»§a báº¡n!
        <button onclick="this.parentElement.style.display='none'">ÄÃ³ng</button>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="control-group">
                <label>ğŸ” TÃ¬m kiáº¿m Ä‘á»‹a Ä‘iá»ƒm</label>
                <input type="text" id="searchInput" placeholder="Nháº­p tÃªn Ä‘á»‹a Ä‘iá»ƒm...">
                <button onclick="searchPlace()">TÃ¬m kiáº¿m</button>
            </div>

            <div class="control-group">
                <label>ğŸ“ ThÃªm marker tÃ¹y chá»‰nh</label>
                <input type="text" id="markerName" placeholder="TÃªn Ä‘á»‹a Ä‘iá»ƒm">
                <button onclick="addCustomMarker()">ThÃªm Marker (Click trÃªn map)</button>
            </div>

            <div class="control-group">
                <button class="secondary" onclick="clearMarkers()">XÃ³a táº¥t cáº£ Markers</button>
                <button class="secondary" onclick="getCurrentLocation()">ğŸ“ Vá»‹ trÃ­ hiá»‡n táº¡i</button>
            </div>

            <div class="info-box">
                <h3>ğŸ“Š ThÃ´ng tin</h3>
                <p><strong>Tá»a Ä‘á»™:</strong> <span id="currentCoords">-</span></p>
                <p><strong>Zoom:</strong> <span id="currentZoom">-</span></p>
                <p><strong>Markers:</strong> <span id="markerCount">0</span></p>
            </div>

            <div class="control-group">
                <h3 style="margin-bottom: 10px;">ğŸ“Œ Danh sÃ¡ch Markers</h3>
                <ul class="marker-list" id="markerList"></ul>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <script>
        let map;
        let markers = [];
        let infoWindow;
        let addMarkerMode = false;

        // Khá»Ÿi táº¡o map
        function initMap() {
            // áº¨n cáº£nh bÃ¡o khi map load thÃ nh cÃ´ng
            document.getElementById('apiWarning').style.display = 'none';

            // Tá»a Ä‘á»™ máº·c Ä‘á»‹nh: TP.HCM
            const defaultLocation = { lat: 10.7769, lng: 106.7009 };

            map = new google.maps.Map(document.getElementById('map'), {
                center: defaultLocation,
                zoom: 13,
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true
            });

            infoWindow = new google.maps.InfoWindow();

            // Láº¯ng nghe sá»± kiá»‡n click trÃªn map
            map.addListener('click', (e) => {
                if (addMarkerMode) {
                    const name = document.getElementById('markerName').value || 'Äá»‹a Ä‘iá»ƒm má»›i';
                    addMarker(e.latLng, name);
                    addMarkerMode = false;
                    document.getElementById('markerName').value = '';
                }
            });

            // Láº¯ng nghe sá»± kiá»‡n di chuyá»ƒn map
            map.addListener('center_changed', updateMapInfo);
            map.addListener('zoom_changed', updateMapInfo);

            // Cáº­p nháº­t thÃ´ng tin ban Ä‘áº§u
            updateMapInfo();
        }

        // ThÃªm marker
        function addMarker(location, title) {
            const marker = new google.maps.Marker({
                position: location,
                map: map,
                title: title,
                animation: google.maps.Animation.DROP
            });

            // ThÃªm sá»± kiá»‡n click cho marker
            marker.addListener('click', () => {
                const lat = typeof location.lat === 'function' ? location.lat() : location.lat;
                const lng = typeof location.lng === 'function' ? location.lng() : location.lng;
                
                infoWindow.setContent(`
                    <div style="padding: 10px;">
                        <h3 style="margin: 0 0 10px 0; color: #1976d2;">${title}</h3>
                        <p style="margin: 5px 0;"><strong>VÄ© Ä‘á»™:</strong> ${lat.toFixed(6)}</p>
                        <p style="margin: 5px 0;"><strong>Kinh Ä‘á»™:</strong> ${lng.toFixed(6)}</p>
                        <button onclick="removeMarkerByTitle('${title}')" style="margin-top: 10px; padding: 8px 16px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">XÃ³a marker nÃ y</button>
                    </div>
                `);
                infoWindow.open(map, marker);
            });

            markers.push({ marker, title, location });
            updateMarkerList();
            updateMarkerCount();
        }

        // XÃ³a marker theo title
        function removeMarkerByTitle(title) {
            const index = markers.findIndex(m => m.title === title);
            if (index !== -1) {
                markers[index].marker.setMap(null);
                markers.splice(index, 1);
                updateMarkerList();
                updateMarkerCount();
                infoWindow.close();
            }
        }

        // XÃ³a táº¥t cáº£ markers
        function clearMarkers() {
            markers.forEach(m => m.marker.setMap(null));
            markers = [];
            updateMarkerList();
            updateMarkerCount();
        }

        // TÃ¬m kiáº¿m Ä‘á»‹a Ä‘iá»ƒm
        function searchPlace() {
            const input = document.getElementById('searchInput').value.trim();
            if (!input) {
                alert('Vui lÃ²ng nháº­p tÃªn Ä‘á»‹a Ä‘iá»ƒm!');
                return;
            }

            if (!google?.maps?.places) {
                alert('Places API chÆ°a sáºµn sÃ ng. Vui lÃ²ng kiá»ƒm tra API Key!');
                return;
            }

            const service = new google.maps.places.PlacesService(map);
            service.findPlaceFromQuery({
                query: input,
                fields: ['name', 'geometry']
            }, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results?.[0]) {
                    const place = results[0];
                    map.setCenter(place.geometry.location);
                    map.setZoom(15);
                    addMarker(place.geometry.location, place.name);
                    document.getElementById('searchInput').value = '';
                } else {
                    alert('KhÃ´ng tÃ¬m tháº¥y: ' + input);
                }
            });
        }

        // ThÃªm marker tÃ¹y chá»‰nh
        function addCustomMarker() {
            addMarkerMode = true;
            alert('Click vÃ o báº¥t ká»³ Ä‘Ã¢u trÃªn map Ä‘á»ƒ thÃªm marker!');
        }

        // Láº¥y vá»‹ trÃ­ hiá»‡n táº¡i
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                alert('TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹!');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    map.setCenter(pos);
                    map.setZoom(15);
                    addMarker(pos, 'ğŸ“ Vá»‹ trÃ­ cá»§a báº¡n');
                },
                () => alert('KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­. Vui lÃ²ng cho phÃ©p truy cáº­p!')
            );
        }



        // Cáº­p nháº­t thÃ´ng tin map
        function updateMapInfo() {
            const center = map.getCenter();
            document.getElementById('currentCoords').textContent = 
                `${center.lat().toFixed(4)}, ${center.lng().toFixed(4)}`;
            document.getElementById('currentZoom').textContent = map.getZoom();
        }

        // Cáº­p nháº­t sá»‘ lÆ°á»£ng markers
        function updateMarkerCount() {
            document.getElementById('markerCount').textContent = markers.length;
        }

        // Cáº­p nháº­t danh sÃ¡ch markers
        function updateMarkerList() {
            const list = document.getElementById('markerList');
            list.innerHTML = '';
            markers.forEach((m) => {
                const lat = typeof m.location.lat === 'function' ? m.location.lat() : m.location.lat;
                const lng = typeof m.location.lng === 'function' ? m.location.lng() : m.location.lng;
                
                const li = document.createElement('li');
                li.className = 'marker-item';
                li.innerHTML = `<strong>${m.title}</strong><br>
                                <small>${lat.toFixed(4)}, ${lng.toFixed(4)}</small>`;
                li.onclick = () => {
                    map.setCenter(m.location);
                    map.setZoom(15);
                    google.maps.event.trigger(m.marker, 'click');
                };
                list.appendChild(li);
            });
        }

        // Event listener cho tÃ¬m kiáº¿m
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchPlace();
        });
    </script>

    <!-- 
        âš ï¸ THAY YOUR_API_KEY_HERE Báº°NG API KEY Cá»¦A Báº N âš ï¸
        Láº¥y API key táº¡i: https://console.cloud.google.com/
    -->
       
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrcMewnsYngjpYP2wyJWA2LCWStmpACnQ&callback=initMap&libraries=places" async defer></script>
</body>
</html>